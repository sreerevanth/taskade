<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Taskade Pro Max - Ultimate Task Manager</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;900&family=Rajdhani:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap');

:root {
  /* Light Theme (Default) */
  --bg: #ffffff;
  --bg-secondary: #f7f7f7;
  --card-bg: #ffffff;
  --border: #e0e0e0;
  --text: #1a1a1a;
  --text-secondary: #666666;
  --primary: #000000;
  --primary-hover: #333333;
  --high: #ef4444;
  --medium: #f59e0b;
  --low: #10b981;
  --success: #10b981;
  --shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
  --border-radius: 12px;
}

body.dark-theme {
  /* Dark Theme */
  --bg: #1a1a1a;
  --bg-secondary: #252525;
  --card-bg: #252525;
  --border: #333333;
  --text: #ffffff;
  --text-secondary: #999999;
  --primary: #ffffff;
  --primary-hover: #e0e0e0;
  --shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  font-family: 'Rajdhani', 'DM Sans', sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
  padding: 40px;
  transition: all 0.3s ease;
  overflow-x: hidden;
}

body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: transparent;
  pointer-events: none;
  z-index: 0;
}

@keyframes float {
  0%, 100% { transform: translate(0, 0) rotate(0deg); }
  50% { transform: translate(50px, 50px) rotate(5deg); }
}


.container {
  max-width: 1600px;
  margin: 0 auto;
  position: relative;
  z-index: 1;
}

/* Sync Status Bar */
.sync-bar {
  position: fixed;
  top: 20px;
  right: 20px;
  background: var(--card-bg);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 12px 20px;
  z-index: 1000;
  box-shadow: var(--shadow);
  display: flex;
  gap: 12px;
  align-items: center;
}

.sync-status {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 0.85rem;
  font-weight: 600;
}

.sync-dot {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  background: var(--success);
}

.sync-dot.syncing {
  background: #f59e0b;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

.sync-dot.error {
  background: var(--high);
  animation: none;
}

/* Auth Container */
.auth-container {
  max-width: 450px;
  margin: 100px auto;
  background: var(--card-bg);
  padding: 40px;
  border-radius: var(--border-radius);
  border: 1px solid var(--border);
  box-shadow: var(--shadow);
  text-align: center;
}

.auth-container h1 {
  font-family: 'Orbitron', 'Syne', sans-serif;
  font-size: 2.5rem;
  margin-bottom: 10px;
  color: var(--primary);
  text-transform: uppercase;
  letter-spacing: 2px;
}

.auth-container p {
  opacity: 0.7;
  margin-bottom: 30px;
}

.auth-input {
  width: 100%;
  padding: 14px 18px;
  border: 1px solid var(--border);
  border-radius: 8px;
  background: var(--bg);
  color: var(--text);
  font-size: 1rem;
  outline: none;
  margin-bottom: 15px;
  transition: all 0.3s ease;
}

.auth-input:focus {
  border-color: var(--primary);
}

.auth-btn {
  width: 100%;
  background: var(--primary);
  border: none;
  padding: 14px 32px;
  border-radius: 12px;
  color: var(--bg);
  font-weight: 700;
  cursor: pointer;
  transition: all 0.3s ease;
  font-size: 1rem;
  margin-bottom: 10px;
  font-family: 'Orbitron', sans-serif;
  text-transform: uppercase;
  letter-spacing: 1px;
}

.auth-btn:hover {
  background: var(--primary-hover);
}

.auth-btn.secondary {
  background: transparent;
  border: 1px solid var(--border);
  color: var(--text);
}

.divider {
  margin: 25px 0;
  text-align: center;
  position: relative;
}

.divider::before {
  content: '';
  position: absolute;
  top: 50%;
  left: 0;
  right: 0;
  height: 1px;
  background: var(--border);
}

.divider span {
  position: relative;
  background: var(--card-bg);
  padding: 0 15px;
  color: var(--text-secondary);
  font-size: 0.85rem;
}

.google-btn {
  width: 100%;
  background: white;
  color: #1f2937;
  border: 2px solid #e5e7eb;
  padding: 14px 32px;
  border-radius: 12px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
}

.google-btn:hover {
  background: #f9fafb;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

/* Theme Toggle Switch (Apple Style) */
.theme-toggle-container {
  position: fixed;
  top: 20px;
  left: 20px;
  z-index: 1000;
  display: flex;
  align-items: center;
  gap: 12px;
}

.theme-toggle {
  position: relative;
  width: 60px;
  height: 32px;
  background: var(--border);
  border-radius: 16px;
  cursor: pointer;
  transition: background 0.3s ease;
}

.theme-toggle.active {
  background: var(--primary);
}

.theme-toggle-slider {
  position: absolute;
  top: 4px;
  left: 4px;
  width: 24px;
  height: 24px;
  background: white;
  border-radius: 50%;
  transition: transform 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

.theme-toggle.active .theme-toggle-slider {
  transform: translateX(28px);
  background: var(--bg);
}

.theme-icon {
  font-size: 14px;
}

/* Header */
.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 60px;
  flex-wrap: wrap;
  gap: 30px;
}

.logo-section {
  display: flex;
  align-items: center;
  gap: 15px;
}

.logo-icon {
  width: 60px;
  height: 60px;
  background: var(--primary);
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 2rem;
  color: var(--bg);
  font-weight: 700;
}

.logo-text h1 {
  margin: 0;
  font-size: 2.5rem;
  font-weight: 800;
  font-family: 'Orbitron', 'Syne', sans-serif;
  color: var(--primary);
  text-transform: uppercase;
  letter-spacing: 2px;
}

.pro-badge {
  display: inline-block;
  background: linear-gradient(135deg, #10b981, #059669);
  padding: 4px 12px;
  border-radius: 20px;
  font-size: 0.7rem;
  font-weight: 700;
  color: white;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-left: 10px;
}

.logo-text p {
  margin: 5px 0 0 0;
  opacity: 0.7;
  font-size: 0.9rem;
}

.header-actions {
  display: flex;
  gap: 12px;
  align-items: center;
  flex-wrap: wrap;
}

.icon-btn {
  background: var(--card-bg);
  border: 1px solid var(--border);
  padding: 12px 16px;
  border-radius: 8px;
  color: var(--text);
  cursor: pointer;
  font-size: 1rem;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  gap: 8px;
  font-weight: 600;
}

.icon-btn:hover {
  border-color: var(--primary);
}

.user-profile {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 8px 16px;
  background: var(--bg-secondary);
  border-radius: 12px;
}

.user-avatar {
  width: 35px;
  height: 35px;
  border-radius: 50%;
  background: var(--primary);
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 700;
  color: var(--bg);
}

/* AI Assistant Panel */
.ai-panel {
  background: var(--card-bg);
  border: 1px solid var(--border);
  border-radius: var(--border-radius);
  padding: 30px;
  margin-bottom: 30px;
  display: none;
  animation: slideDown 0.3s ease;
}

.ai-panel.active {
  display: block;
}

@keyframes slideDown {
  from { opacity: 0; transform: translateY(-20px); }
  to { opacity: 1; transform: translateY(0); }
}

.ai-header {
  display: flex;
  align-items: center;
  gap: 15px;
  margin-bottom: 20px;
}

.ai-title {
  font-family: 'Orbitron', sans-serif;
  font-size: 1.8rem;
  font-weight: 700;
  color: var(--primary);
}

.ai-beta {
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  padding: 3px 10px;
  border-radius: 15px;
  font-size: 0.65rem;
  font-weight: 700;
  color: white;
  text-transform: uppercase;
}

.ai-suggestions {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 15px;
  margin-bottom: 20px;
}

.ai-card {
  background: var(--bg-secondary);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 20px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.ai-card:hover {
  border-color: var(--primary);
}

.ai-card-title {
  font-weight: 700;
  margin-bottom: 8px;
  font-size: 1.1rem;
}

.ai-card-desc {
  opacity: 0.7;
  font-size: 0.9rem;
}

/* View Switcher */
.view-controls {
  display: flex;
  gap: 20px;
  margin-bottom: 30px;
  flex-wrap: wrap;
  align-items: center;
}

.view-tabs {
  display: flex;
  gap: 10px;
  background: var(--bg-secondary);
  padding: 6px;
  border-radius: 10px;
  border: 1px solid var(--border);
}

.view-tab {
  padding: 10px 20px;
  border: none;
  background: transparent;
  color: var(--text);
  border-radius: 10px;
  cursor: pointer;
  font-weight: 600;
  transition: all 0.3s ease;
}

.view-tab.active {
  background: var(--primary);
  color: var(--bg);
}

/* Input Section */
.input-section {
  background: var(--card-bg);
  padding: 30px;
  border-radius: var(--border-radius);
  box-shadow: var(--shadow);
  margin-bottom: 30px;
  border: 1px solid var(--border);
}

.input-row {
  display: flex;
  gap: 15px;
  flex-wrap: wrap;
  margin-bottom: 15px;
}

.task-input, .priority-select, .due-date-input, .tags-input {
  padding: 14px 18px;
  border: 1px solid var(--border);
  border-radius: 8px;
  background: var(--bg);
  color: var(--text);
  font-size: 0.95rem;
  outline: none;
  transition: all 0.3s ease;
}

.task-input {
  flex: 1;
  min-width: 300px;
}

.task-input:focus, .priority-select:focus, .due-date-input:focus, .tags-input:focus {
  border-color: var(--primary);
}

.add-btn {
  background: var(--primary);
  border: none;
  padding: 14px 32px;
  border-radius: 12px;
  color: var(--bg);
  font-weight: 700;
  cursor: pointer;
  transition: all 0.3s ease;
  font-size: 1rem;
  font-family: 'Orbitron', sans-serif;
  text-transform: uppercase;
  letter-spacing: 1px;
}

.add-btn:hover {
  background: var(--primary-hover);
}

/* Task List */
.task-list {
  min-height: 200px;
}

.task-item {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  padding: 20px 25px;
  margin-bottom: 20px;
  background: var(--card-bg);
  border-radius: var(--border-radius);
  border: 1px solid var(--border);
  transition: all 0.3s ease;
  cursor: pointer;
  animation: slideIn 0.4s ease;
}

.task-item:hover {
  border-color: var(--primary);
}

.task-item.completed {
  opacity: 0.6;
}

.task-left {
  display: flex;
  align-items: flex-start;
  gap: 18px;
  flex: 1;
}

.task-checkbox {
  width: 24px;
  height: 24px;
  border: 3px solid var(--primary);
  border-radius: 8px;
  background: transparent;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s ease;
  flex-shrink: 0;
  margin-top: 3px;
}

.task-checkbox.completed {
  background: var(--primary);
  border-color: var(--primary);
}

.task-checkbox.completed::after {
  content: '‚úì';
  color: var(--bg);
  font-size: 16px;
  font-weight: bold;
}

.priority-indicator {
  width: 14px;
  height: 14px;
  border-radius: 50%;
  flex-shrink: 0;
  margin-top: 5px;
}

.priority-high { background: var(--high); }
.priority-medium { background: var(--medium); }
.priority-low { background: var(--low); }

.task-content {
  flex: 1;
}

.task-text {
  font-weight: 600;
  margin-bottom: 8px;
  word-break: break-word;
  font-size: 1.05rem;
}

.task-text.completed {
  text-decoration: line-through;
}

.task-meta {
  font-size: 0.85rem;
  opacity: 0.7;
  display: flex;
  gap: 15px;
  flex-wrap: wrap;
  margin-bottom: 10px;
}

.task-tag {
  background: var(--bg-secondary);
  padding: 3px 10px;
  border-radius: 12px;
  font-size: 0.75rem;
  font-weight: 600;
}

.device-badge {
  background: var(--bg-secondary);
  padding: 3px 10px;
  border-radius: 12px;
  font-size: 0.75rem;
  font-weight: 600;
}

.subtasks-container {
  margin-top: 10px;
  padding-left: 30px;
}

.subtask-item {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 8px 0;
  font-size: 0.9rem;
}

.subtask-checkbox {
  width: 18px;
  height: 18px;
  border: 2px solid var(--primary);
  border-radius: 4px;
  cursor: pointer;
  flex-shrink: 0;
  background: transparent;
}

.subtask-checkbox.completed {
  background: var(--primary);
}

.subtask-checkbox.completed::after {
  content: '‚úì';
  color: var(--bg);
  font-size: 12px;
  font-weight: bold;
  display: flex;
  align-items: center;
  justify-content: center;
}

.subtask-text {
  flex: 1;
}

.subtask-text.completed {
  text-decoration: line-through;
  opacity: 0.6;
}

.task-actions {
  display: flex;
  gap: 10px;
  opacity: 1;  /* Always visible - no hover needed */
  transition: opacity 0.3s ease;
}

/* Buttons always visible for better mobile experience */

.action-btn {
  background: var(--bg-secondary);
  border: 1px solid var(--border);
  cursor: pointer;
  padding: 8px;
  border-radius: 8px;
  transition: all 0.3s ease;
  font-size: 1.1rem;
  color: var(--text);
}

.action-btn:hover {
  background: var(--bg);
  border-color: var(--primary);
}

/* Board View (Kanban) */
.board-view {
  display: none;
  grid-template-columns: repeat(3, 1fr);
  gap: 20px;
}

.board-view.active {
  display: grid;
}

.board-column {
  background: var(--card-bg);
  border: 1px solid var(--border);
  border-radius: var(--border-radius);
  padding: 20px;
  min-height: 500px;
}

.board-column-header {
  font-family: 'Orbitron', sans-serif;
  font-weight: 700;
  margin-bottom: 20px;
  font-size: 1.2rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.board-count {
  background: var(--bg-secondary);
  padding: 4px 12px;
  border-radius: 15px;
  font-size: 0.85rem;
}

.board-tasks {
  display: flex;
  flex-direction: column;
  gap: 15px;
}

.board-task {
  background: var(--bg-secondary);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 15px;
  cursor: move;
  transition: all 0.3s ease;
}

.board-task:hover {
  transform: translateY(-3px);
  box-shadow: var(--glow);
  border-color: var(--primary);
}

.board-task.dragging {
  opacity: 0.5;
}

/* Gantt Chart View */
.gantt-view {
  display: none;
  background: var(--card-bg);
  border: 1px solid var(--border);
  border-radius: var(--border-radius);
  padding: 30px;
  overflow-x: auto;
}

.gantt-view.active {
  display: block;
}

.gantt-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 25px;
}

.gantt-title {
  font-family: 'Orbitron', sans-serif;
  font-size: 1.8rem;
  font-weight: 700;
  color: var(--primary);
}

.gantt-container {
  min-width: 1000px;
}

.gantt-timeline {
  display: grid;
  grid-template-columns: 200px repeat(14, 1fr);
  gap: 5px;
  margin-bottom: 15px;
  padding-bottom: 15px;
  border-bottom: 1px solid var(--border);
}

.gantt-day {
  text-align: center;
  font-weight: 600;
  font-size: 0.8rem;
  opacity: 0.7;
  padding: 10px;
}

.gantt-day.today {
  color: var(--primary);
  font-weight: 700;
  opacity: 1;
}

.gantt-row {
  display: grid;
  grid-template-columns: 200px repeat(14, 1fr);
  gap: 5px;
  margin-bottom: 10px;
  align-items: center;
}

.gantt-task-name {
  font-weight: 600;
  padding-right: 15px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.gantt-cell {
  height: 40px;
  border: 1px solid var(--border);
  border-radius: 4px;
  position: relative;
}

.gantt-bar {
  height: 100%;
  background: var(--primary);
  border-radius: 4px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.7rem;
  font-weight: 700;
  color: var(--bg);
  cursor: pointer;
  transition: all 0.3s ease;
}

.gantt-bar:hover {
  opacity: 0.8;
}

.gantt-bar.high { background: #ef4444; color: white; }
.gantt-bar.medium { background: #f59e0b; color: white; }
.gantt-bar.low { background: #10b981; color: white; }

/* Calendar View */
.calendar-view {
  display: none;
  background: var(--card-bg);
  border: 1px solid var(--border);
  border-radius: var(--border-radius);
  padding: 30px;
}

.calendar-view.active {
  display: block;
}

.calendar-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 30px;
}

.calendar-month {
  font-family: 'Orbitron', sans-serif;
  font-size: 2rem;
  font-weight: 700;
  color: var(--primary);
}

.calendar-nav {
  display: flex;
  gap: 10px;
}

.calendar-grid {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 15px;
}

.calendar-day-header {
  text-align: center;
  font-weight: 700;
  padding: 10px;
  opacity: 0.7;
  font-size: 0.9rem;
  text-transform: uppercase;
}

.calendar-day {
  aspect-ratio: 1;
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 10px;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  flex-direction: column;
  position: relative;
}

.calendar-day:hover {
  background: var(--bg-secondary);
  border-color: var(--primary);
  transform: scale(1.05);
}

.calendar-day.today {
  background: var(--bg-secondary);
  border-color: var(--primary);
}

.calendar-day.other-month {
  opacity: 0.3;
}

.calendar-day-number {
  font-weight: 700;
  margin-bottom: 5px;
}

.calendar-task-dots {
  display: flex;
  gap: 3px;
  flex-wrap: wrap;
  margin-top: auto;
}

.calendar-task-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: var(--primary);
}

/* Calendar Day Modal */
.calendar-day-modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.7);
  z-index: 10000;
  align-items: center;
  justify-content: center;
}

.calendar-day-modal.active {
  display: flex;
}

.calendar-day-modal-content {
  background: var(--card-bg);
  border: 1px solid var(--border);
  border-radius: var(--border-radius);
  padding: 30px;
  max-width: 500px;
  width: 90%;
  max-height: 70vh;
  overflow-y: auto;
  box-shadow: var(--shadow);
}

.calendar-day-modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
  padding-bottom: 15px;
  border-bottom: 1px solid var(--border);
}

.calendar-day-modal-title {
  font-size: 1.5rem;
  font-weight: 700;
  color: var(--text);
}

.calendar-day-modal-close {
  background: none;
  border: none;
  font-size: 1.5rem;
  cursor: pointer;
  color: var(--text);
  opacity: 0.7;
}

.calendar-day-modal-close:hover {
  opacity: 1;
}

.calendar-day-tasks-list {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.calendar-day-task-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 15px;
  background: var(--bg-secondary);
  border: 1px solid var(--border);
  border-radius: 8px;
  transition: all 0.3s ease;
}

.calendar-day-task-item:hover {
  border-color: var(--primary);
}

.calendar-day-task-left {
  display: flex;
  align-items: center;
  gap: 12px;
  flex: 1;
}

.calendar-day-task-priority {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  flex-shrink: 0;
}

.calendar-day-task-text {
  font-weight: 500;
  flex: 1;
  word-break: break-word;
}

.calendar-day-task-text.completed {
  text-decoration: line-through;
  opacity: 0.6;
}

.calendar-day-task-actions {
  display: flex;
  gap: 8px;
}

.calendar-day-delete-btn {
  background: #ef4444;
  border: none;
  padding: 6px 12px;
  border-radius: 6px;
  color: white;
  cursor: pointer;
  font-size: 0.85rem;
  font-weight: 600;
  transition: all 0.3s ease;
}

.calendar-day-delete-btn:hover {
  background: #dc2626;
}

.calendar-day-empty {
  text-align: center;
  padding: 40px 20px;
  color: var(--text-secondary);
}

.calendar-day-empty-icon {
  font-size: 3rem;
  margin-bottom: 10px;
  opacity: 0.5;
}

/* Pomodoro Widget */
.pomodoro-widget {
  position: fixed;
  bottom: 30px;
  right: 30px;
  background: var(--card-bg);
  border: 1px solid var(--border);
  border-radius: var(--border-radius);
  padding: 25px;
  box-shadow: var(--shadow);
  min-width: 280px;
  z-index: 999;
  display: none;
}

.pomodoro-widget.active {
  display: block;
  animation: slideUp 0.3s ease;
}

@keyframes slideUp {
  from { opacity: 0; transform: translateY(100px); }
  to { opacity: 1; transform: translateY(0); }
}

.pomodoro-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 15px;
}

.pomodoro-title {
  font-family: 'Orbitron', sans-serif;
  font-weight: 700;
  font-size: 1.2rem;
}

.pomodoro-close {
  background: none;
  border: none;
  font-size: 1.5rem;
  cursor: pointer;
  color: var(--text);
  opacity: 0.7;
}

.pomodoro-timer {
  font-size: 3rem;
  font-weight: 900;
  text-align: center;
  margin: 20px 0;
  font-family: 'JetBrains Mono', monospace;
  color: var(--primary);
}

.pomodoro-controls {
  display: flex;
  gap: 10px;
  justify-content: center;
}

.pomodoro-btn {
  padding: 10px 20px;
  border: none;
  border-radius: 10px;
  background: var(--primary);
  color: var(--bg);
  font-weight: 700;
  cursor: pointer;
  transition: all 0.3s ease;
  font-family: 'Orbitron', sans-serif;
  text-transform: uppercase;
  font-size: 0.85rem;
}

.pomodoro-btn:hover {
  background: var(--primary-hover);
}

.pomodoro-status {
  text-align: center;
  margin-top: 15px;
  font-size: 0.9rem;
  opacity: 0.7;
}

/* Modal */
.modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.9);
  z-index: 10000;
  align-items: center;
  justify-content: center;
  backdrop-filter: blur(10px);
}

.modal.active {
  display: flex;
}

.modal-content {
  background: var(--card-bg);
  border: 1px solid var(--border);
  border-radius: var(--border-radius);
  padding: 40px;
  max-width: 600px;
  width: 90%;
  max-height: 80vh;
  overflow-y: auto;
  box-shadow: var(--shadow);
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 25px;
}

.modal-title {
  font-family: 'Orbitron', sans-serif;
  font-size: 1.8rem;
  font-weight: 700;
}

.modal-close {
  background: none;
  border: none;
  font-size: 2rem;
  cursor: pointer;
  color: var(--text);
  opacity: 0.7;
}

.modal-section {
  margin-bottom: 25px;
}

.modal-section h3 {
  margin-bottom: 15px;
  font-weight: 600;
}

.modal-input {
  width: 100%;
  padding: 12px 16px;
  border: 1px solid var(--border);
  border-radius: 8px;
  background: var(--bg);
  color: var(--text);
  font-size: 0.95rem;
  outline: none;
  margin-bottom: 10px;
}

.modal-input:focus {
  border-color: var(--primary);
}

.modal-btn {
  background: var(--primary);
  border: none;
  padding: 10px 20px;
  border-radius: 10px;
  color: var(--bg);
  font-weight: 700;
  cursor: pointer;
  transition: all 0.3s ease;
}

.modal-btn:hover {
  background: var(--primary-hover);
}

.empty-state {
  text-align: center;
  padding: 80px 20px;
  opacity: 0.6;
}

.empty-state-icon {
  font-size: 5rem;
  margin-bottom: 25px;
  opacity: 0.5;
}

.toast {
  position: fixed;
  bottom: 30px;
  left: 50%;
  transform: translateX(-50%);
  background: var(--card-bg);
  color: var(--text);
  padding: 16px 28px;
  border-radius: 12px;
  box-shadow: var(--shadow);
  z-index: 20000;
  opacity: 0;
  transition: opacity 0.3s ease;
  pointer-events: none;
  font-weight: 600;
  border: 1px solid var(--border);
}

.toast.show {
  opacity: 1;
  pointer-events: auto;
}

.setup-banner {
  background: var(--bg-secondary);
  border: 1px solid var(--border);
  padding: 20px;
  border-radius: var(--border-radius);
  margin-bottom: 30px;
  text-align: center;
}

.setup-banner h3 {
  margin-bottom: 10px;
  font-family: 'Orbitron', 'Syne', sans-serif;
}

@media (max-width: 768px) {
  body {
    padding: 10px;
  }

  .container {
    padding: 0;
  }

  /* Header adjustments */
  .header {
    flex-direction: column;
    align-items: flex-start;
    gap: 15px;
  }

  .logo-section {
    width: 100%;
  }

  .logo-icon {
    width: 50px;
    height: 50px;
    font-size: 1.5rem;
  }

  .logo-text h1 {
    font-size: 1.8rem;
  }

  .logo-text p {
    font-size: 0.8rem;
  }

  .header-actions {
    width: 100%;
    justify-content: space-between;
    flex-wrap: wrap;
  }

  .icon-btn {
    padding: 10px 12px;
    font-size: 0.85rem;
    flex: 1;
    min-width: auto;
    justify-content: center;
  }

  /* Sync bar - make smaller */
  .sync-bar {
    top: 10px;
    right: 10px;
    padding: 8px 12px;
    font-size: 0.75rem;
  }

  /* Theme selector - move to bottom */
  .theme-selector {
    top: auto;
    bottom: 80px;
    right: 10px;
    flex-direction: row;
    gap: 8px;
  }

  .theme-btn {
    padding: 10px;
    font-size: 1rem;
  }

  /* Auth container */
  .auth-container {
    margin: 50px auto;
    padding: 30px 20px;
  }

  .auth-container h1 {
    font-size: 2rem;
  }

  /* Input section */
  .input-section {
    padding: 20px 15px;
  }

  .input-row {
    flex-direction: column;
    gap: 12px;
  }

  .task-input,
  .priority-select,
  .due-date-input,
  .tags-input {
    width: 100%;
    min-width: 100%;
  }

  .add-btn {
    width: 100%;
    padding: 14px;
  }

  /* View controls */
  .view-controls {
    flex-direction: column;
    align-items: stretch;
  }

  .view-tabs {
    width: 100%;
    flex-wrap: wrap;
    justify-content: space-around;
  }

  .view-tab {
    flex: 1;
    min-width: 70px;
    padding: 10px 8px;
    font-size: 0.8rem;
  }

  /* AI Panel */
  .ai-panel {
    padding: 20px 15px;
  }

  .ai-header {
    flex-direction: column;
    align-items: flex-start;
  }

  .ai-title {
    font-size: 1.4rem;
  }

  .ai-suggestions {
    grid-template-columns: 1fr;
  }

  /* Task items */
  .task-item {
    padding: 15px;
    flex-direction: column;
    align-items: flex-start;
  }

  .task-left {
    width: 100%;
    flex-wrap: wrap;
  }

  .task-content {
    width: 100%;
  }

  .task-text {
    font-size: 1rem;
  }

  .task-meta {
    flex-direction: column;
    align-items: flex-start;
    gap: 8px;
  }

  .task-actions {
    width: 100%;
    margin-top: 10px;
    justify-content: flex-end;
  }

  .action-btn {
    padding: 10px 12px;
    font-size: 1.2rem;
  }

  /* Board view - stack columns */
  .board-view {
    grid-template-columns: 1fr;
    gap: 15px;
  }

  .board-column {
    min-height: 300px;
  }

  /* Gantt view - scroll horizontally */
  .gantt-view {
    padding: 15px;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
  }

  .gantt-container {
    min-width: 800px;
  }

  .gantt-title {
    font-size: 1.4rem;
  }

  .gantt-task-name {
    font-size: 0.85rem;
  }

  /* Calendar view */
  .calendar-view {
    padding: 15px;
  }

  .calendar-month {
    font-size: 1.4rem;
  }

  .calendar-grid {
    gap: 8px;
  }

  .calendar-day {
    padding: 8px;
  }

  .calendar-day-number {
    font-size: 0.9rem;
  }

  .calendar-task-dot {
    width: 6px;
    height: 6px;
  }

  /* Pomodoro widget */
  .pomodoro-widget {
    bottom: 10px;
    right: 10px;
    left: 10px;
    min-width: auto;
    padding: 20px 15px;
  }

  .pomodoro-timer {
    font-size: 2.5rem;
  }

  .pomodoro-controls {
    flex-direction: column;
  }

  .pomodoro-btn {
    width: 100%;
  }

  /* Modal */
  .modal-content {
    padding: 25px 20px;
    width: 95%;
    max-height: 90vh;
  }

  .modal-title {
    font-size: 1.4rem;
  }

  /* User profile - smaller */
  .user-profile {
    padding: 6px 12px;
    font-size: 0.85rem;
  }

  .user-avatar {
    width: 30px;
    height: 30px;
    font-size: 0.9rem;
  }

  /* Setup banner */
  .setup-banner {
    padding: 15px;
    font-size: 0.9rem;
  }

  .setup-banner h3 {
    font-size: 1.2rem;
  }

  .setup-banner ol {
    font-size: 0.85rem;
    padding-left: 20px;
  }

  /* Toast */
  .toast {
    bottom: 20px;
    left: 10px;
    right: 10px;
    transform: none;
    padding: 12px 16px;
    font-size: 0.9rem;
  }

  /* Empty state */
  .empty-state-icon {
    font-size: 4rem;
  }

  .empty-state h3 {
    font-size: 1.3rem;
  }
}
</style>
</head>
<body>
  <!-- Theme Toggle -->
  <div class="theme-toggle-container">
    <div class="theme-toggle" id="themeToggle" onclick="app.toggleTheme()">
      <div class="theme-toggle-slider">
        <span class="theme-icon" id="themeIcon">‚òÄÔ∏è</span>
      </div>
    </div>
  </div>

  <!-- Sync Status Bar -->
  <div class="sync-bar" id="syncBar">
    <div class="sync-status">
      <div class="sync-dot" id="syncDot"></div>
      <span id="syncStatus">Offline</span>
    </div>
  </div>

  <!-- Auth Container -->
  <div class="auth-container" id="authContainer">
    <h1>TASKADE</h1>
    <p>Sign in to sync your tasks</p>
    
    <div id="loginForm">
      <input type="email" class="auth-input" id="emailInput" placeholder="Email address">
      <input type="password" class="auth-input" id="passwordInput" placeholder="Password">
      <button class="auth-btn" onclick="app.login()">Sign In</button>
      <button class="auth-btn secondary" onclick="app.showSignup()">Create Account</button>
      
      <div class="divider"><span>or</span></div>
      
      <button class="google-btn" onclick="app.googleSignIn()">
        <svg width="20" height="20" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
        Continue with Google
      </button>
    </div>
    
    <div id="signupForm" style="display: none;">
      <input type="text" class="auth-input" id="signupName" placeholder="Your name">
      <input type="email" class="auth-input" id="signupEmail" placeholder="Email address">
      <input type="password" class="auth-input" id="signupPassword" placeholder="Create password">
      <button class="auth-btn" onclick="app.signup()">Create Account</button>
      <button class="auth-btn secondary" onclick="app.showLogin()">Back to Sign In</button>
    </div>
  </div>

  <!-- Main App -->
  <div class="container" id="mainApp" style="display: none;">
    <!-- Setup Banner -->
    <div class="setup-banner" id="setupBanner" style="display: none;">
      <h3>üîß Firebase Setup Required</h3>
      <p>Follow FIREBASE-SETUP.md to enable cloud sync</p>
    </div>

    <!-- Header -->
    <header class="header">
      <div class="logo-section">
        <div class="logo-icon">T</div>
        <div class="logo-text">
          <h1>TASKADE</h1>
          <p>Task management made simple</p>
        </div>
      </div>
      <div class="header-actions">
        <button class="icon-btn" onclick="app.toggleAI()">ü§ñ AI</button>
        <button class="icon-btn" onclick="app.togglePomodoro()">üçÖ Focus</button>
        <button class="icon-btn" onclick="app.exportJSON()">üì• Export</button>
        <button class="icon-btn" onclick="document.getElementById('importFile').click()">üì§ Import</button>
        <div class="user-profile" id="userProfile">
          <div class="user-avatar" id="userAvatar">U</div>
          <span id="userName">User</span>
        </div>
        <button class="icon-btn" onclick="app.logout()">üö™</button>
      </div>
    </header>

    <!-- AI Assistant Panel -->
    <div class="ai-panel" id="aiPanel">
      <div class="ai-header">
        <div style="display: flex; align-items: center; gap: 15px;">
          <span style="font-size: 2rem; animation: spin 10s linear infinite;">ü§ñ</span>
          <div>
            <h2 class="ai-title">AI ASSISTANT <span class="ai-beta">BETA</span></h2>
            <p style="opacity: 0.7; margin-top: 5px;">Smart suggestions powered by AI</p>
          </div>
        </div>
      </div>
      
      <div class="ai-suggestions">
        <div class="ai-card" onclick="app.aiPrioritize()">
          <div class="ai-card-title">‚ö° Smart Prioritization</div>
          <div class="ai-card-desc">AI analyzes and re-prioritizes based on deadlines</div>
        </div>
        <div class="ai-card" onclick="app.aiEstimate()">
          <div class="ai-card-title">‚è±Ô∏è Time Estimates</div>
          <div class="ai-card-desc">Get AI-generated time estimates for tasks</div>
        </div>
        <div class="ai-card" onclick="app.aiBreakdown()">
          <div class="ai-card-title">üìã Task Breakdown</div>
          <div class="ai-card-desc">Break complex tasks into subtasks</div>
        </div>
        <div class="ai-card" onclick="app.aiSchedule()">
          <div class="ai-card-title">üìÖ Optimal Schedule</div>
          <div class="ai-card-desc">AI suggests best order and timing</div>
        </div>
      </div>
    </div>

    <!-- View Controls -->
    <div class="view-controls">
      <div class="view-tabs">
        <button class="view-tab active" onclick="app.switchView('list')">üìã List</button>
        <button class="view-tab" onclick="app.switchView('board')">üìä Board</button>
        <button class="view-tab" onclick="app.switchView('gantt')">üìà Gantt</button>
        <button class="view-tab" onclick="app.switchView('calendar')">üìÖ Calendar</button>
      </div>
    </div>

    <!-- Input Section -->
    <div class="input-section">
      <div class="input-row">
        <input type="text" class="task-input" id="taskInput" placeholder="What needs to be done?">
        <select class="priority-select" id="prioritySelect">
          <option value="high">üî¥ High</option>
          <option value="medium" selected>üü° Medium</option>
          <option value="low">üü¢ Low</option>
        </select>
      </div>
      <div class="input-row">
        <input type="date" class="due-date-input" id="dueDateInput">
        <input type="text" class="tags-input" id="tagsInput" placeholder="Tags (comma separated)">
        <button class="add-btn" id="addBtn">‚ûï Add</button>
      </div>
    </div>

    <!-- List View -->
    <div class="task-list" id="taskList">
      <div class="empty-state">
        <h3>No tasks yet</h3>
        <p>Add a task to get started</p>
      </div>
    </div>

    <!-- Board View -->
    <div class="board-view" id="boardView">
      <div class="board-column">
        <div class="board-column-header">
          <span>üìã TO DO</span>
          <span class="board-count" id="todoCount">0</span>
        </div>
        <div class="board-tasks" id="todoTasks"></div>
      </div>
      <div class="board-column">
        <div class="board-column-header">
          <span>üîÑ IN PROGRESS</span>
          <span class="board-count" id="progressCount">0</span>
        </div>
        <div class="board-tasks" id="progressTasks"></div>
      </div>
      <div class="board-column">
        <div class="board-column-header">
          <span>‚úÖ DONE</span>
          <span class="board-count" id="doneCount">0</span>
        </div>
        <div class="board-tasks" id="doneTasks"></div>
      </div>
    </div>

    <!-- Gantt View -->
    <div class="gantt-view" id="ganttView">
      <div class="gantt-header">
        <h2 class="gantt-title">PROJECT TIMELINE</h2>
      </div>
      <div class="gantt-container" id="ganttContainer"></div>
    </div>

    <!-- Calendar View -->
    <div class="calendar-view" id="calendarView">
      <div class="calendar-header">
        <h2 class="calendar-month" id="calendarMonth">December 2024</h2>
        <div class="calendar-nav">
          <button class="icon-btn" onclick="app.changeMonth(-1)">‚óÄ</button>
          <button class="icon-btn" onclick="app.todayCalendar()">Today</button>
          <button class="icon-btn" onclick="app.changeMonth(1)">‚ñ∂</button>
        </div>
      </div>
      <div class="calendar-grid" id="calendarGrid"></div>
    </div>
  </div>

  <!-- Pomodoro Widget -->
  <div class="pomodoro-widget" id="pomodoroWidget">
    <div class="pomodoro-header">
      <h3 class="pomodoro-title">üçÖ FOCUS TIME</h3>
      <button class="pomodoro-close" onclick="app.togglePomodoro()">√ó</button>
    </div>
    <div class="pomodoro-timer" id="pomodoroTimer">25:00</div>
    <div class="pomodoro-controls">
      <button class="pomodoro-btn" id="pomodoroStart" onclick="app.togglePomodoroTimer()">START</button>
      <button class="pomodoro-btn" onclick="app.resetPomodoro()">RESET</button>
    </div>
    <div class="pomodoro-status" id="pomodoroStatus">Ready to focus üéØ</div>
  </div>

  <!-- Task Detail Modal -->
  <div class="modal" id="taskModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">Task Details</h2>
        <button class="modal-close" onclick="app.closeModal()">√ó</button>
      </div>
      <div id="modalBody"></div>
    </div>
  </div>

  <!-- Calendar Day Modal -->
  <div class="calendar-day-modal" id="calendarDayModal">
    <div class="calendar-day-modal-content">
      <div class="calendar-day-modal-header">
        <h3 class="calendar-day-modal-title" id="calendarDayModalTitle">Tasks</h3>
        <button class="calendar-day-modal-close" onclick="app.closeCalendarDayModal()">√ó</button>
      </div>
      <div class="calendar-day-tasks-list" id="calendarDayTasksList"></div>
    </div>
  </div>

  <!-- Toast -->
  <div class="toast" id="toast"></div>

  <!-- Hidden File Input -->
  <input type="file" id="importFile" accept=".json" style="display: none;" onchange="app.importJSON(event)">

  <script type="module">
    const firebaseConfig = {
        apiKey: "YOUR API KEY",
        authDomain: "taskade-cloud.firebaseapp.com",
        projectId: "taskade-cloud",
        storageBucket: "taskade-cloud.firebasestorage.app",
        messagingSenderId: "ID",
        appId: "APP ID"
    };

    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
    import { getFirestore, collection, addDoc, updateDoc, deleteDoc, doc, onSnapshot, query, orderBy, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

    const isFirebaseConfigured = firebaseConfig.apiKey !== "YOUR_API_KEY";
    let auth, db;
    
    if (isFirebaseConfigured) {
      const firebaseApp = initializeApp(firebaseConfig);
      auth = getAuth(firebaseApp);
      db = getFirestore(firebaseApp);
    }

    class TaskadeProMax {
      async getKey(password) {
        const enc = new TextEncoder();
        const keyMaterial = await crypto.subtle.importKey(
          "raw",
          enc.encode(password),
          { name: "PBKDF2" },
          false,
          ["deriveKey"]
        );

        return crypto.subtle.deriveKey(
          {
            name: "PBKDF2",
            salt: enc.encode("taskade-salt"),
            iterations: 100000,
            hash: "SHA-256",
          },
          keyMaterial,
          { name: "AES-GCM", length: 256 },
          false,
          ["encrypt", "decrypt"]
        );
      }

      async encrypt(text) {
        const enc = new TextEncoder();
        const iv = crypto.getRandomValues(new Uint8Array(12));

        const encrypted = await crypto.subtle.encrypt(
          { name: "AES-GCM", iv },
          this.userKey,
          enc.encode(text)
        );

        return {
          iv: Array.from(iv),
          data: Array.from(new Uint8Array(encrypted))
        };
      }

      async decrypt(obj) {
        const dec = new TextDecoder();

        const decrypted = await crypto.subtle.decrypt(
          { name: "AES-GCM", iv: new Uint8Array(obj.iv) },
          this.userKey,
          new Uint8Array(obj.data)
        );

        return dec.decode(decrypted);
      }

      constructor() {
        this.userKey = null;
        this.tasks = [];
        this.user = null;
        this.currentView = 'list';
        this.currentTheme = localStorage.getItem('theme') || 'light';
        this.currentMonth = new Date();
        this.pomodoroTime = 25 * 60;
        this.pomodoroInterval = null;
        this.pomodoroRunning = false;
        this.useFirebase = isFirebaseConfigured;
        
        this.initializeElements();
        this.bindEvents();
        this.applyTheme(this.currentTheme);
        this.requestNotificationPermission();
        
        if (!this.useFirebase) {
          this.showSetupBanner();
          this.tasks = JSON.parse(localStorage.getItem('taskade-pro-max-tasks')) || [];
          this.showApp();
          this.render();
        } else {
          onAuthStateChanged(auth, (user) => {
            if (user) {
              this.user = user;
              this.showApp();
              this.subscribeToTasks();
            } else {
              this.showAuth();
            }
          });
        }
      }

      initializeElements() {
        this.authContainer = document.getElementById('authContainer');
        this.mainApp = document.getElementById('mainApp');
        this.taskInput = document.getElementById('taskInput');
        this.prioritySelect = document.getElementById('prioritySelect');
        this.dueDateInput = document.getElementById('dueDateInput');
        this.tagsInput = document.getElementById('tagsInput');
        this.addBtn = document.getElementById('addBtn');
        this.taskList = document.getElementById('taskList');
        this.toast = document.getElementById('toast');
        this.syncDot = document.getElementById('syncDot');
        this.syncStatus = document.getElementById('syncStatus');
      }

      bindEvents() {
        this.addBtn.addEventListener('click', () => this.addTask());
        this.taskInput.addEventListener('keypress', (e) => {
          if (e.key === 'Enter') this.addTask();
        });
      }

      requestNotificationPermission() {
        if ('Notification' in window && Notification.permission === 'default') {
          Notification.requestPermission();
        }
      }

      showNotification(title, body) {
        if ('Notification' in window && Notification.permission === 'granted') {
          new Notification(title, { body, icon: '‚ö°' });
        }
      }

      showAuth() {
        this.authContainer.style.display = 'block';
        this.mainApp.style.display = 'none';
      }

      showApp() {
        if (this.useFirebase) {
          document.getElementById('setupBanner').style.display = 'none';
        }
        this.authContainer.style.display = 'none';
        this.mainApp.style.display = 'block';
        
        if (this.user) {
          document.getElementById('userName').textContent = this.user.displayName || this.user.email;
          document.getElementById('userAvatar').textContent = (this.user.displayName || this.user.email).charAt(0).toUpperCase();
          this.updateSyncStatus('synced');
        }
      }

      showSetupBanner() {
        document.getElementById('setupBanner').style.display = 'block';
      }

      showLogin() {
        document.getElementById('loginForm').style.display = 'block';
        document.getElementById('signupForm').style.display = 'none';
      }

      showSignup() {
        document.getElementById('loginForm').style.display = 'none';
        document.getElementById('signupForm').style.display = 'block';
      }

      async login() {
        if (!this.useFirebase) {
          this.showToast('‚ùå Firebase not configured');
          return;
        }
        const email = document.getElementById('emailInput').value;
        const password = document.getElementById('passwordInput').value;
        try {
          await signInWithEmailAndPassword(auth, email, password);
          
          const encryptionPassword = prompt("Enter encryption password");
          this.userKey = await this.getKey(encryptionPassword);
          
          this.showToast('‚úÖ Logged in!');
        } catch (error) {
          this.showToast('‚ùå ' + error.message);
        }
      }

      async signup() {
        if (!this.useFirebase) {
          this.showToast('‚ùå Firebase not configured');
          return;
        }
        const email = document.getElementById('signupEmail').value;
        const password = document.getElementById('signupPassword').value;
        try {
          await createUserWithEmailAndPassword(auth, email, password);
          
          const encryptionPassword = prompt("Enter encryption password");
          this.userKey = await this.getKey(encryptionPassword);
          
          this.showToast('‚úÖ Account created!');
        } catch (error) {
          this.showToast('‚ùå ' + error.message);
        }
      }

      async googleSignIn() {
        if (!this.useFirebase) {
          this.showToast('‚ùå Firebase not configured');
          return;
        }
        try {
          const provider = new GoogleAuthProvider();
          await signInWithPopup(auth, provider);
          this.showToast('‚úÖ Logged in with Google!');
        } catch (error) {
          this.showToast('‚ùå ' + error.message);
        }
      }

      async logout() {
        if (this.useFirebase) {
          await signOut(auth);
        }
        this.showAuth();
        this.showToast('üëã Logged out');
      }

      subscribeToTasks() {
        if (!this.useFirebase) return;
        const q = query(
          collection(db, `users/${this.user.uid}/tasks`),
          orderBy('createdAt', 'desc')
        );
        this.unsubscribe = onSnapshot(q, (snapshot) => {
          this.tasks = snapshot.docs.map(doc => ({
            id: doc.id,
            ...doc.data()
          }));
          this.render();
          this.updateSyncStatus('synced');
        }, (error) => {
          console.error('Sync error:', error);
          this.updateSyncStatus('error');
        });
      }

      async addTask() {
        const text = this.taskInput.value.trim();
        if (!text) return;

        const task = {
          text: text,
          priority: this.prioritySelect.value,
          dueDate: this.dueDateInput.value || null,
          tags: this.tagsInput.value ? this.tagsInput.value.split(',').map(t => t.trim()) : [],
          completed: false,
          status: 'todo',
          subtasks: [],
          createdAt: this.useFirebase ? serverTimestamp() : new Date().toISOString(),
          device: this.getDeviceName()
        };

        if (this.useFirebase) {
          this.updateSyncStatus('syncing');
          try {
            await addDoc(collection(db, `users/${this.user.uid}/tasks`), task);
            this.showToast('‚úÖ Task added & synced!');
            this.showNotification('Task Added', text);
          } catch (error) {
            this.showToast('‚ùå Sync failed');
            this.updateSyncStatus('error');
          }
        } else {
          task.id = Date.now();
          task.createdAt = new Date().toISOString();
          this.tasks.unshift(task);
          this.saveTasks();
          this.render();
          this.showToast('‚úÖ Task added!');
        }

        this.taskInput.value = '';
        this.dueDateInput.value = '';
        this.tagsInput.value = '';
      }

      async toggleTask(id) {
        const task = this.tasks.find(t => t.id === id);
        if (!task) return;

        if (this.useFirebase) {
          this.updateSyncStatus('syncing');
          try {
            await updateDoc(doc(db, `users/${this.user.uid}/tasks`, id), {
              completed: !task.completed
            });
            if (!task.completed) {
              this.showNotification('Task Completed!', task.text);
            }
          } catch (error) {
            this.showToast('‚ùå Update failed');
          }
        } else {
          task.completed = !task.completed;
          this.saveTasks();
          this.render();
        }
      }

      async deleteTask(id) {
        if (!confirm('Delete this task?')) return;

        if (this.useFirebase) {
          try {
            await deleteDoc(doc(db, `users/${this.user.uid}/tasks`, id));
            this.showToast('üóëÔ∏è Deleted');
          } catch (error) {
            this.showToast('‚ùå Delete failed');
          }
        } else {
          this.tasks = this.tasks.filter(t => t.id !== id);
          this.saveTasks();
          this.render();
          this.showToast('üóëÔ∏è Deleted');
        }
      }

      async changeStatus(id, status) {
        if (this.useFirebase) {
          try {
            await updateDoc(doc(db, `users/${this.user.uid}/tasks`, id), { status });
          } catch (error) {
            this.showToast('‚ùå Update failed');
          }
        } else {
          const task = this.tasks.find(t => t.id === id);
          if (task) {
            task.status = status;
            this.saveTasks();
            this.render();
          }
        }
      }

      showTaskModal(id) {
        const task = this.tasks.find(t => t.id === id);
        if (!task) return;

        const modal = document.getElementById('taskModal');
        const modalBody = document.getElementById('modalBody');
        
        modalBody.innerHTML = `
          <div class="modal-section">
            <h3>${task.text}</h3>
            <p>Priority: ${task.priority} | Due: ${task.dueDate || 'None'}</p>
            ${task.tags.length > 0 ? `<p>Tags: ${task.tags.map(t => '#' + t).join(', ')}</p>` : ''}
          </div>
          
          <div class="modal-section">
            <h3>Subtasks</h3>
            <div id="subtasksList">
              ${task.subtasks.map((st, i) => `
                <div class="subtask-item">
                  <div class="subtask-checkbox ${st.completed ? 'completed' : ''}" onclick="app.toggleSubtask('${id}', ${i})"></div>
                  <div class="subtask-text ${st.completed ? 'completed' : ''}">${st.text}</div>
                </div>
              `).join('')}
            </div>
            <input type="text" class="modal-input" id="newSubtask" placeholder="Add subtask...">
            <button class="modal-btn" onclick="app.addSubtask('${id}')">Add Subtask</button>
          </div>
        `;
        
        modal.classList.add('active');
      }

      closeModal() {
        document.getElementById('taskModal').classList.remove('active');
      }

      async addSubtask(taskId) {
        const input = document.getElementById('newSubtask');
        const text = input.value.trim();
        if (!text) return;

        const task = this.tasks.find(t => t.id === taskId);
        if (!task) return;

        const subtask = { text, completed: false };
        task.subtasks.push(subtask);

        if (this.useFirebase) {
          try {
            await updateDoc(doc(db, `users/${this.user.uid}/tasks`, taskId), {
              subtasks: task.subtasks
            });
          } catch (error) {
            this.showToast('‚ùå Update failed');
          }
        } else {
          this.saveTasks();
        }

        this.showTaskModal(taskId);
        this.render();
      }

      async toggleSubtask(taskId, subtaskIndex) {
        const task = this.tasks.find(t => t.id === taskId);
        if (!task) return;

        task.subtasks[subtaskIndex].completed = !task.subtasks[subtaskIndex].completed;

        if (this.useFirebase) {
          try {
            await updateDoc(doc(db, `users/${this.user.uid}/tasks`, taskId), {
              subtasks: task.subtasks
            });
          } catch (error) {
            this.showToast('‚ùå Update failed');
          }
        } else {
          this.saveTasks();
        }

        this.showTaskModal(taskId);
        this.render();
      }

      getDeviceName() {
        const ua = navigator.userAgent;
        if (/mobile/i.test(ua)) return 'üì± Mobile';
        if (/tablet|ipad/i.test(ua)) return 'üì± Tablet';
        return 'üíª Desktop';
      }

      toggleTheme() {
        document.body.classList.toggle('dark-theme');
        const isDark = document.body.classList.contains('dark-theme');
        const toggle = document.getElementById('themeToggle');
        const icon = document.getElementById('themeIcon');
        
        if (isDark) {
          toggle.classList.add('active');
          icon.textContent = 'üåô';
        } else {
          toggle.classList.remove('active');
          icon.textContent = '‚òÄÔ∏è';
        }
        
        localStorage.setItem('theme', isDark ? 'dark' : 'light');
      }

      applyTheme(theme) {
        if (theme === 'dark') {
          document.body.classList.add('dark-theme');
          document.getElementById('themeToggle').classList.add('active');
          document.getElementById('themeIcon').textContent = 'üåô';
        } else {
          document.body.classList.remove('dark-theme');
          document.getElementById('themeToggle').classList.remove('active');
          document.getElementById('themeIcon').textContent = '‚òÄÔ∏è';
        }
      }

      toggleAI() {
        const panel = document.getElementById('aiPanel');
        panel.classList.toggle('active');
      }

      aiPrioritize() {
        this.tasks.sort((a, b) => {
          const priorityOrder = { high: 0, medium: 1, low: 2 };
          return priorityOrder[a.priority] - priorityOrder[b.priority];
        });
        this.saveTasks();
        this.render();
        this.showToast('ü§ñ AI re-prioritized tasks!');
      }

      aiEstimate() {
        this.tasks.forEach(t => {
          if (!t.estimate) t.estimate = `${Math.floor(Math.random() * 4 + 1)}h`;
        });
        this.saveTasks();
        this.render();
        this.showToast('‚è±Ô∏è AI added estimates!');
      }

      aiBreakdown() {
        this.tasks.filter(t => t.subtasks.length === 0).forEach(t => {
          t.subtasks = [
            { text: 'Research & Planning', completed: false },
            { text: 'Implementation', completed: false },
            { text: 'Testing & Review', completed: false }
          ];
        });
        this.saveTasks();
        this.render();
        this.showToast('üìã AI broke down tasks!');
      }

      aiSchedule() {
        let date = new Date();
        this.tasks.filter(t => !t.dueDate).forEach((t, i) => {
          const nextDate = new Date(date);
          nextDate.setDate(nextDate.getDate() + i);
          t.dueDate = nextDate.toISOString().split('T')[0];
        });
        this.saveTasks();
        this.render();
        this.showToast('üìÖ AI optimized schedule!');
      }

      switchView(view) {
        this.currentView = view;
        document.querySelectorAll('.view-tab').forEach(tab => tab.classList.remove('active'));
        event.target.classList.add('active');
        
        document.getElementById('taskList').style.display = view === 'list' ? 'block' : 'none';
        document.getElementById('boardView').classList.toggle('active', view === 'board');
        document.getElementById('ganttView').classList.toggle('active', view === 'gantt');
        document.getElementById('calendarView').classList.toggle('active', view === 'calendar');
        
        if (view === 'board') this.renderBoard();
        else if (view === 'gantt') this.renderGantt();
        else if (view === 'calendar') this.renderCalendar();
      }

      renderBoard() {
        const todo = this.tasks.filter(t => t.status === 'todo' && !t.completed);
        const progress = this.tasks.filter(t => t.status === 'inprogress');
        const done = this.tasks.filter(t => t.status === 'done' || t.completed);

        document.getElementById('todoCount').textContent = todo.length;
        document.getElementById('progressCount').textContent = progress.length;
        document.getElementById('doneCount').textContent = done.length;

        this.renderBoardColumn('todoTasks', todo, 'todo');
        this.renderBoardColumn('progressTasks', progress, 'inprogress');
        this.renderBoardColumn('doneTasks', done, 'done');
      }

      renderBoardColumn(columnId, tasks, status) {
        const column = document.getElementById(columnId);
        column.innerHTML = tasks.map(t => `
          <div class="board-task" draggable="true">
            <strong>${t.text}</strong>
            <div style="margin-top: 10px; display: flex; gap: 8px;">
              ${status === 'todo' ? `<button class="modal-btn" onclick="app.changeStatus('${t.id}', 'inprogress')">Start ‚Üí</button>` : ''}
              ${status === 'inprogress' ? `<button class="modal-btn" onclick="app.changeStatus('${t.id}', 'done')">Done ‚úì</button>` : ''}
              ${status === 'done' ? `<button class="modal-btn" onclick="app.changeStatus('${t.id}', 'todo')">‚Üê Reopen</button>` : ''}
            </div>
          </div>
        `).join('');
      }

      renderGantt() {
        const container = document.getElementById('ganttContainer');
        const tasksWithDates = this.tasks.filter(t => t.dueDate);
        
        if (tasksWithDates.length === 0) {
          container.innerHTML = '<div style="text-align: center; padding: 50px; opacity: 0.6;">Add tasks with due dates to see Gantt chart</div>';
          return;
        }

        const today = new Date();
        const days = Array.from({length: 14}, (_, i) => {
          const date = new Date(today);
          date.setDate(date.getDate() + i);
          return date;
        });

        let html = `<div class="gantt-timeline">
          <div></div>
          ${days.map(d => `<div class="gantt-day ${d.toDateString() === today.toDateString() ? 'today' : ''}">${d.getDate()}<br>${d.toLocaleDateString('en-US', {month: 'short'})}</div>`).join('')}
        </div>`;

        tasksWithDates.forEach(task => {
          const taskDate = new Date(task.dueDate);
          const dayIndex = Math.floor((taskDate - today) / (1000 * 60 * 60 * 24));
          
          html += `<div class="gantt-row">
            <div class="gantt-task-name">${task.text}</div>
            ${days.map((_, i) => `
              <div class="gantt-cell">
                ${i === dayIndex ? `<div class="gantt-bar ${task.priority}">${task.text.slice(0, 10)}</div>` : ''}
              </div>
            `).join('')}
          </div>`;
        });

        container.innerHTML = html;
      }

      renderCalendar() {
        const year = this.currentMonth.getFullYear();
        const month = this.currentMonth.getMonth();
        
        document.getElementById('calendarMonth').textContent = 
          new Date(year, month).toLocaleDateString('en-US', { month: 'long', year: 'numeric' });

        const firstDay = new Date(year, month, 1).getDay();
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        const grid = document.getElementById('calendarGrid');
        
        grid.innerHTML = '';
        
        ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].forEach(day => {
          const header = document.createElement('div');
          header.className = 'calendar-day-header';
          header.textContent = day;
          grid.appendChild(header);
        });

        for (let i = 0; i < firstDay; i++) {
          const day = document.createElement('div');
          day.className = 'calendar-day other-month';
          grid.appendChild(day);
        }

        const today = new Date();
        for (let i = 1; i <= daysInMonth; i++) {
          const day = document.createElement('div');
          day.className = 'calendar-day';
          
          const currentDate = new Date(year, month, i);
          const dateStr = currentDate.toISOString().split('T')[0];
          
          if (currentDate.toDateString() === today.toDateString()) {
            day.classList.add('today');
          }

          const tasksOnDay = this.tasks.filter(t => t.dueDate === dateStr);
          
          day.innerHTML = `
            <div class="calendar-day-number">${i}</div>
            <div class="calendar-task-dots">
              ${tasksOnDay.slice(0, 3).map(t => `<div class="calendar-task-dot"></div>`).join('')}
              ${tasksOnDay.length > 3 ? `<div style="font-size: 0.7rem; font-weight: 600;">${tasksOnDay.length}</div>` : ''}
            </div>
          `;
          
          // Add click handler to show tasks for this day
          day.addEventListener('click', () => this.showCalendarDayTasks(dateStr, currentDate));
          
          grid.appendChild(day);
        }
      }

      showCalendarDayTasks(dateStr, date) {
        const tasksOnDay = this.tasks.filter(t => t.dueDate === dateStr);
        const modal = document.getElementById('calendarDayModal');
        const title = document.getElementById('calendarDayModalTitle');
        const tasksList = document.getElementById('calendarDayTasksList');
        
        // Format date nicely
        const formattedDate = date.toLocaleDateString('en-US', { 
          weekday: 'long', 
          year: 'numeric', 
          month: 'long', 
          day: 'numeric' 
        });
        
        title.textContent = formattedDate;
        
        if (tasksOnDay.length === 0) {
          tasksList.innerHTML = `
            <div class="calendar-day-empty">
              <div class="calendar-day-empty-icon">üìÖ</div>
              <p>No tasks scheduled for this day</p>
            </div>
          `;
        } else {
          tasksList.innerHTML = tasksOnDay.map(task => `
            <div class="calendar-day-task-item">
              <div class="calendar-day-task-left">
                <div class="calendar-day-task-priority priority-${task.priority}"></div>
                <div class="calendar-day-task-text ${task.completed ? 'completed' : ''}">
                  ${task.text}
                </div>
              </div>
              <div class="calendar-day-task-actions">
                <button class="calendar-day-delete-btn" onclick="app.deleteTaskFromCalendar('${task.id}', '${dateStr}')">
                  Delete
                </button>
              </div>
            </div>
          `).join('');
        }
        
        modal.classList.add('active');
      }

      closeCalendarDayModal() {
        document.getElementById('calendarDayModal').classList.remove('active');
      }

      async deleteTaskFromCalendar(taskId, dateStr) {
        if (!confirm('Delete this task?')) return;
        
        await this.deleteTask(taskId);
        
        // Refresh the modal
        const date = new Date(dateStr + 'T00:00:00');
        this.showCalendarDayTasks(dateStr, date);
        
        // Re-render calendar to update dots
        this.renderCalendar();
      }

      changeMonth(delta) {
        this.currentMonth.setMonth(this.currentMonth.getMonth() + delta);
        this.renderCalendar();
      }

      todayCalendar() {
        this.currentMonth = new Date();
        this.renderCalendar();
      }

      togglePomodoro() {
        document.getElementById('pomodoroWidget').classList.toggle('active');
      }

      togglePomodoroTimer() {
        if (this.pomodoroRunning) {
          this.pausePomodoro();
        } else {
          this.startPomodoro();
        }
      }

      startPomodoro() {
        this.pomodoroRunning = true;
        document.getElementById('pomodoroStart').textContent = 'PAUSE';
        document.getElementById('pomodoroStatus').textContent = 'Focus mode activated! üéØ';
        
        this.pomodoroInterval = setInterval(() => {
          this.pomodoroTime--;
          this.updatePomodoroDisplay();
          
          if (this.pomodoroTime <= 0) {
            this.pomodoroComplete();
          }
        }, 1000);
      }

      pausePomodoro() {
        this.pomodoroRunning = false;
        clearInterval(this.pomodoroInterval);
        document.getElementById('pomodoroStart').textContent = 'RESUME';
        document.getElementById('pomodoroStatus').textContent = 'Paused ‚è∏Ô∏è';
      }

      resetPomodoro() {
        this.pomodoroRunning = false;
        clearInterval(this.pomodoroInterval);
        this.pomodoroTime = 25 * 60;
        this.updatePomodoroDisplay();
        document.getElementById('pomodoroStart').textContent = 'START';
        document.getElementById('pomodoroStatus').textContent = 'Ready to focus üéØ';
      }

      updatePomodoroDisplay() {
        const minutes = Math.floor(this.pomodoroTime / 60);
        const seconds = this.pomodoroTime % 60;
        document.getElementById('pomodoroTimer').textContent = 
          `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
      }

      pomodoroComplete() {
        this.resetPomodoro();
        this.showToast('üéâ Pomodoro complete! Take a break!');
        this.showNotification('Pomodoro Complete', 'Great work! Time for a 5-min break.');
      }

      exportJSON() {
        const dataStr = JSON.stringify(this.tasks, null, 2);
        const blob = new Blob([dataStr], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = `taskade-backup-${new Date().toISOString().split('T')[0]}.json`;
        link.click();
        URL.revokeObjectURL(url);
        this.showToast('üì• Exported!');
      }

      importJSON(event) {
        const file = event.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = (e) => {
          try {
            const imported = JSON.parse(e.target.result);
            if (Array.isArray(imported)) {
              this.tasks = imported;
              this.saveTasks();
              this.render();
              this.showToast('üì§ Imported successfully!');
            }
          } catch (error) {
            this.showToast('‚ùå Invalid file');
          }
        };
        reader.readAsText(file);
      }

      updateSyncStatus(status) {
        this.syncDot.className = 'sync-dot';
        switch (status) {
          case 'synced':
            this.syncStatus.textContent = '‚òÅÔ∏è Synced';
            break;
          case 'syncing':
            this.syncDot.classList.add('syncing');
            this.syncStatus.textContent = 'üîÑ Syncing...';
            break;
          case 'error':
            this.syncDot.classList.add('error');
            this.syncStatus.textContent = '‚ùå Error';
            break;
          case 'offline':
            this.syncStatus.textContent = 'üì¥ Offline';
            break;
        }
      }

      render() {
        if (this.currentView === 'list') {
          this.renderList();
        } else if (this.currentView === 'board') {
          this.renderBoard();
        } else if (this.currentView === 'gantt') {
          this.renderGantt();
        } else if (this.currentView === 'calendar') {
          this.renderCalendar();
        }
      }

      renderList() {
        console.log('Rendering list view, tasks:', this.tasks.length); // Debug log
        
        if (this.tasks.length === 0) {
          this.taskList.innerHTML = `
            <div class="empty-state">
              <h3>No tasks yet</h3>
              <p>Add a task to get started</p>
            </div>
          `;
        } else {
          console.log('Rendering tasks:', this.tasks); // Debug log
          this.taskList.innerHTML = this.tasks.map(task => `
            <div class="task-item ${task.completed ? 'completed' : ''}">
              <div class="task-left">
                <div class="task-checkbox ${task.completed ? 'completed' : ''}" 
                     onclick="app.toggleTask('${task.id}')"></div>
                <div class="priority-indicator priority-${task.priority}"></div>
                <div class="task-content" onclick="app.showTaskModal('${task.id}')">
                  <div class="task-text ${task.completed ? 'completed' : ''}">${task.text}</div>
                  <div class="task-meta">
                    ${task.dueDate ? `<span>üìÖ ${this.formatDate(task.dueDate)}</span>` : ''}
                    <span>‚≠ê ${task.priority.toUpperCase()}</span>
                    ${task.tags.map(tag => `<span class="task-tag">#${tag}</span>`).join('')}
                    <span class="device-badge">${task.device || 'üíª'}</span>
                    ${task.subtasks.length > 0 ? `<span>üìã ${task.subtasks.filter(st => st.completed).length}/${task.subtasks.length}</span>` : ''}
                  </div>
                </div>
              </div>
              <div class="task-actions" style="display: flex !important; opacity: 1 !important; gap: 10px;">
                <button class="action-btn" onclick="app.showTaskModal('${task.id}')" title="Details" style="display: block;">üìù</button>
                <button class="action-btn" onclick="app.deleteTask('${task.id}')" title="Delete" style="display: block;">üóëÔ∏è</button>
              </div>
            </div>
          `).join('');
        }
      }

      formatDate(dateString) {
        if (!dateString) return '';
        const date = new Date(dateString);
        const today = new Date();
        const tomorrow = new Date(today);
        tomorrow.setDate(tomorrow.getDate() + 1);

        if (date.toDateString() === today.toDateString()) return 'Today';
        if (date.toDateString() === tomorrow.toDateString()) return 'Tomorrow';
        return date.toLocaleDateString();
      }

      saveTasks() {
        localStorage.setItem('taskade-pro-max-tasks', JSON.stringify(this.tasks));
      }

      showToast(message) {
        this.toast.textContent = message;
        this.toast.classList.add('show');
        setTimeout(() => this.toast.classList.remove('show'), 3000);
      }
    }

    window.app = new TaskadeProMax();
  </script>
</body>
</html>

